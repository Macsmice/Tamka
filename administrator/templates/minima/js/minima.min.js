/**
 * @version     0.9
 * @package     Minima
 * @author      Marco Barbosa
 * @copyright   Copyright (C) 2010 Marco Barbosa. All rights reserved.
 * @license     GNU General Public License version 2 or later; see LICENSE.txt
 */

(function(){var c;var d=function(a){var b=$(a.target);var e=b.getParents();c.each(function(f){var h=f.element;if(h!=b&&!e.contains(h)){f.fn.call(h,a)}})};Element.Events.outerClick={onAdd:function(a){if(!c){document.addEvent("click",d);c=[]}c.push({element:this,fn:a})},onRemove:function(a){c=c.filter(function(b){return b.element!=this||b.fn!=a},this);if(!c.length){document.removeEvent("click",d);c=null}}}})();Element.implement("switchClass",function(e,d){var c=this.hasClass(e);this.removeClass(c?e:d).addClass(c?d:e);return this});$extend(Selectors.Pseudo,{visible:function(){if(this.getStyle("visibility")!="hidden"&&this.isVisible()&&this.isDisplayed()){return this}}});Element.implement("toggleReveal",function(b,a){return b.isDisplayed()?b.dissolve(a):b.reveal(a)});var ScrollSpy=new Class({Implements:[Options,Events],options:{container:window,max:0,min:0,mode:"vertical"},initialize:function(b){this.setOptions(b);this.container=document.id(this.options.container);this.enters=this.leaves=0;this.inside=false;this.listener=function(e){var a=this.container.getScroll(),f=a[this.options.mode=="vertical"?"y":"x"];if(f>=this.options.min&&(this.options.max==0||f<=this.options.max)){if(!this.inside){this.inside=true;this.enters++;this.fireEvent("enter",[a,this.enters,e])}this.fireEvent("tick",[a,this.inside,this.enters,this.leaves,e])}else{if(this.inside){this.inside=false;this.leaves++;this.fireEvent("leave",[a,this.leaves,e])}}this.fireEvent("scroll",[a,this.inside,this.enters,this.leaves,e])};this.addListener()},start:function(){this.container.addEvent("scroll",this.listener.bind(this))},stop:function(){this.container.removeEvent("scroll",this.listener.bind(this))},addListener:function(){this.start()}});MinimaPanelClass=new Class({Implements:[Options],panelStatus:{"true":"active","false":"inactive"},panel:null,options:{prev:"",next:"",panelList:"",panelPage:"",panelWrapper:"",toIncrement:0,increment:900},maxRightIncrement:null,panelSlide:null,numberOfExtensions:null,initialize:function(b){this.setOptions(b);this.panel=new Fx.Slide.Mine(this.options.panelWrapper,{mode:"vertical",transition:Fx.Transitions.Pow.easeOut}).hide();if(this.options.next){this.panelSlide=new Fx.Tween(this.options.panelList,{duration:500,transition:"back:in:out"});this.numberOfExtensions=this.options.panelList.getChildren("li").length;this.options.panelList.setStyle("width",Math.round(this.numberOfExtensions/9)*this.options.increment);this.maxRightIncrement=-Math.ceil(this.options.panelPage.getChildren().length*this.options.increment-this.options.increment);this.showButtons()}},helloWorld:function(){alert("cool")},doPrevious:function(){if(this.options.toIncrement<0){this.options.next.show();this.options.toIncrement+=this.options.increment;this.panelSlide.pause();this.panelSlide.start("margin-left",this.options.toIncrement);this.options.panelPage.getFirst(".current").removeClass("current").getPrevious("li").addClass("current");this.showButtons()}},doNext:function(){if(this.options.toIncrement>this.maxRightIncrement){this.options.prev.show();this.options.toIncrement-=this.options.increment;this.panelSlide.pause();this.panelSlide.start("margin-left",this.options.toIncrement);this.options.panelPage.getFirst(".current").removeClass("current").getNext("li").addClass("current");this.showButtons()}},changeToPage:function(c){var d=c.id.substr("panel-pagination-".length);this.panelSlide.pause();this.options.toIncrement=Math.ceil(0-this.options.increment*d);this.panelSlide.start("margin-left",this.options.toIncrement);this.options.panelPage.getFirst(".current").removeClass("current");c.addClass("current");this.showButtons()},showButtons:function(){if(this.options.toIncrement==0){this.options.prev.hide()}else{this.options.prev.show()}if(this.options.toIncrement==this.maxRightIncrement){this.options.next.hide()}else{this.options.next.show()}}}),MinimaTabsClass=new Class({Implements:[Options],options:{},elements:{tabs:null,content:null},initialize:function(d,c){this.setOptions(d);this.elements=c},showFirst:function(){this.elements.content.pick().removeClass("hide")},hideAllContent:function(){this.elements.content.addClass("hide")},addTabsAction:function(){this.elements.tabs.each(function(c,d){c.addEvents({click:function(a){a.stop();this.elements.tabs.removeClass("active");this.elements.tabs[d].addClass("active");this.elements.content.addClass("hide");this.elements.content[d].removeClass("hide")}.bind(this)})}.bind(this))}}),MinimaClass=new Class({Implements:[Options],options:{},element:{systemMessage:null},initialize:function(d,c){this.setOptions(d);this.element.systemMessage=c.systemMessage},showSystemMessage:function(){if(this.element.systemMessage&&this.element.systemMessage.getElement("ul li:last-child")){var c=this;var d=new Element("a",{href:"#",id:"hide-system-message",html:"hide",events:{click:function(a){c.element.systemMessage.dissolve({duration:"short"})}}});this.element.systemMessage.show().getElement("ul li:last-child").adopt(d)}},makeRowsClickable:function(){var b=$$("input[name=checkall-toggle]");b.addEvent("click",function(){var a=$$(".adminlist tbody tr");a.toggleClass("selected")});$$(".adminlist tbody tr input[type=checkbox]").each(function(a){var f=a.getParent("tr");var e=$$("input[name=boxchecked]");a.addEvent("click",function(c){c&&c.stopPropagation();if(a.checked){f.addClass("selected")}else{f.removeClass("selected")}});f.addEvent("click",function(){if(a.checked){a.set("checked",false);e.set("value",0)}else{a.set("checked",true);e.set("value",1)}a.fireEvent("click")})});$$(".adminlist th img").getParent("th").addClass("active")}}),MinimaToolbarClass=new Class({Implements:[Options],options:{toolbar:$("toolbar"),toolbarElements:$$(".toolbar-list li a"),label:null},bulkActionsArray:new Array(),bulkNonActionsArray:new Array(),minima:null,initialize:function(b){this.minima=document.id(this.options.minima)||document.id("minima");this.setOptions(b)},doToolbar:function(){this.sortItems();this.fixToolbar()},sortItems:function(){var b=this;if(this.options.toolbarElements.length){this.options.toolbarElements.each(function(a){if(a.get("onclick")!=null&&a.get("onclick").contains("if")){b.bulkActionsArray.push(a.getParent("li"))}else{if(a.get("class")!="divider"){b.bulkNonActionsArray.push(a.getParent("li"))}}})}},fixToolbar:function(){var i=this;if(this.bulkActionsArray.length>1){var k=new Element("ul#actions").hide(),l=new Element("li",{id:"bulkActions",events:{click:function(a){this.toggleReveal(k,{duration:200,styles:["border"]});$$(i.minima.getElement("#bulkActions > a:first-child"),i).switchClass("active","inactive")},outerClick:function(){k.dissolve({duration:250});i.minima.getElement("#bulkActions > a:first-child").set("class","inactive")}}}),h=new Element("a[text= "+this.options.label+"]"),g=new Element("span.arrow");this.bulkActionsArray=this.bulkActionsArray.sort(function(a,b){if(a.get("text").toLowerCase()<b.get("text").toLowerCase()){return -1}if(a.get("text").toLowerCase()==b.get("text").toLowerCase()){return 0}return 1});this.bulkActionsArray.each(function(a,b){k.grab(a)});var j=($("toolbar-new"))?"ul > li#toolbar-new":"ul > li";l.inject($("toolbar").getElement(j),"after");l.adopt(h.grab(g),k)}}});window.addEvent("domready",function(){var h=MooTools.lang.get("Minima");contentTop=$("content-top"),toolbar=$("toolbar"),topHead=$("tophead"),minima=$("minima"),subMenu=$("submenu"),itemForm=$("item-form"),Minima=new MinimaClass({},{systemMessage:$("system-message")}),MinimaToolbar=new MinimaToolbarClass({toolbar:toolbar,toolbarElements:minima.getElements(".toolbar-list li a"),label:h.actionBtn});Minima.showSystemMessage();if(minima.getElements(".adminlist").length){Minima.makeRowsClickable()}MinimaToolbar.doToolbar();if(toolbar){toolbar.show()}new Fx.SmoothScroll({links:"#topLink"});var g=$$(".adminlist");if(g.length&&g.get("id")!="adminlist"){g.set("id","adminlist")}if(subMenu){subMenu.addClass("minimaTabs")}if(subMenu&&itemForm){var c=new MinimaTabsClass({},{tabs:$$(".minimaTabs a"),content:itemForm.getChildren("div")}),f=new MinimaTabsClass({},{tabs:$$("#vertical-tabs a"),content:$("tabs").getChildren(".panelform")});c.hideAllContent();c.showFirst();c.addTabsAction();f.hideAllContent();f.showFirst();f.addTabsAction()}scrollSize=document.getScrollSize().y-document.getSize().y;tableHead=minima.getElements("table.adminlist thead");new ScrollSpy({min:200,onEnter:function(){if(scrollSize>400){if(document.body.hasClass("locked")){contentTop.setStyle("left",(topHead.getSize().x-1140)/2)}contentTop.setStyle("width",topHead.getSize().x-40).addClass("fixed")}},onLeave:function(){if(scrollSize>400){contentTop.removeClass("fixed");if(document.body.hasClass("locked")){contentTop.setStyle("width","100%")}}}});var b=$("panel-wrapper");if(b){Fx.Slide.Mine=new Class({Extends:Fx.Slide,initialize:function(j,i){this.parent(j,i);this.wrapper=this.element.getParent()}});var e=new MinimaPanelClass({panelWrapper:$("panel-wrapper"),prev:$("prev"),next:$("next"),panelList:$("panel-list"),panelPage:$("panel-pagination")});$("prev").addEvent("click",function(){e.doPrevious()});$("next").addEvent("click",function(){e.doNext()});$("panel-pagination").getChildren("li").addEvent("click",function(){e.changeToPage(this)});var a=$("more");extraLists=$("list-content"),openPanel=$("panel-tab"),listWrapper=$("list-wrapper");openPanel.addEvents({click:function(){e.panel.toggle()}});e.panel.addEvent("complete",function(){openPanel.set("class",e.panelStatus[e.panel.open])});a.addEvent("click",function(){this.switchClass("active","inactive");this.toggleReveal(extraLists,{heightOverride:"155",duration:250})});var d=function(){a.set("class","inactive");listWrapper.removeClass("active");extraLists.dissolve()};listWrapper.addEvent("outerClick",function(){d()});extraLists.getElements("a").addEvent("click",function(){d()});minima.getElements("#panel-list li").addEvent("click",function(){e.panel.toggle()});minima.getElements("#shortcuts .parent").each(function(i){i.addEvents({click:function(){this.toggleReveal(this.getChildren(".sub")[0]).toggleClass("hover");this.getElement("a").toggleClass("hover")},outerClick:function(){this.getChildren(".sub").dissolve({duration:200}).removeClass("hover");this.getElement("a").removeClass("hover")}})})}});
